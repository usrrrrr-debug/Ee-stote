<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>F T shop â€” Ø§Ù„Ù…ØªØ¬Ø±</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg-1: #f6f3ff;
  --purple-1: #6a1b9a;
  --purple-2: #8e24aa;
  --accent: #ab47bc;
  --muted: #666;
  --white: #ffffff;
  --shadow: 0 10px 30px rgba(15,10,30,0.08);
  --card-bg: #fff;
  --shipping: 400; /* ÙÙ‚Ø· Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ CSS -- Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¨Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ JS */
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:'Cairo',sans-serif;background:linear-gradient(180deg,var(--bg-1),#f0ecff)}
a{color:inherit;text-decoration:none}
.container{max-width:1150px;margin:18px auto;padding:16px}

/* header */
.header{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg,var(--purple-1),var(--purple-2));color:var(--white);box-shadow:var(--shadow)}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#fff,#f3e6ff);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--purple-1)}
.shopTitle{font-weight:700;font-size:18px}
.header-actions{display:flex;gap:8px;align-items:center}

/* hero */
.hero{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin-top:16px;padding:22px;border-radius:12px;background:linear-gradient(180deg, rgba(106,27,154,0.06), rgba(142,36,170,0.04));border:1px solid rgba(106,27,154,0.08)}
.hero .left{max-width:640px}
.hero h1{margin:0;font-size:34px;color:var(--purple-1)}
.hero p{margin:8px 0 0;color:#2b2b2b}

/* layout */
.main{display:grid;grid-template-columns: 1fr 380px;gap:18px;margin-top:18px}
@media(max-width:980px){ .main{grid-template-columns:1fr} .header{flex-direction:column;align-items:flex-start} }

/* product area */
.storePanel{background:var(--card-bg);padding:14px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);box-shadow:var(--shadow)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}

/* card */
.card{background:#fff;border-radius:12px;border:1px solid rgba(0,0,0,0.04);overflow:hidden;box-shadow:0 10px 20px rgba(10,8,20,0.04);display:flex;flex-direction:column}
.card-img{height:220px;display:flex;align-items:center;justify-content:center;background:#f7f7fb}
.card-img img{max-width:100%;max-height:100%;object-fit:contain}
.card-body{padding:12px;flex:1;display:flex;flex-direction:column;gap:8px}
.card h3{margin:0;font-size:16px}
.badges{display:flex;gap:8px;flex-wrap:wrap}
.badge{font-size:12px;padding:6px 8px;border-radius:999px;background:linear-gradient(90deg,var(--purple-1),var(--purple-2));color:white;font-weight:700}

/* price + actions */
.priceRow{display:flex;justify-content:space-between;align-items:center;margin-top:auto}
.price{font-weight:800;color:var(--purple-2);font-size:18px}
.actions{display:flex;gap:8px}
.btn{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn-primary{background:linear-gradient(90deg,var(--purple-1),var(--purple-2));color:white}
.btn-ghost{background:transparent;border:1px solid rgba(30,30,30,0.06);color:#222}

/* sidebar */
.sidebar{display:flex;flex-direction:column;gap:12px}
.card-side{background:white;padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);box-shadow:var(--shadow)}
.cartList{display:flex;flex-direction:column;gap:8px;max-height:280px;overflow:auto}
.cartItem{display:flex;gap:8px;align-items:center;border-radius:8px;padding:8px;border:1px solid rgba(0,0,0,0.03)}
.cartItem img{width:64px;height:48px;object-fit:cover;border-radius:6px}

/* totals */
.totals{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.totalRow{display:flex;justify-content:space-between;align-items:center;font-weight:700}

/* upload form */
.form-row{display:flex;flex-direction:column;gap:8px}
.input,textarea{padding:10px;border-radius:8px;border:1px solid #ddd}
.small{width:48%}

/* modals */
.modal-back{position:fixed;inset:0;background:rgba(2,6,23,0.5);display:none;align-items:center;justify-content:center;z-index:80}
.modal{width:100%;max-width:720px;background:white;border-radius:12px;padding:16px;border:1px solid rgba(0,0,0,0.06)}
.modal h2{margin:0 0 8px 0}

/* footer */
.footer{margin-top:18px;text-align:center;color:var(--muted)}

/* micro interactions */
.iconBtn{background:rgba(255,255,255,0.06);border-radius:10px;padding:8px;cursor:pointer}
.smallNote{font-size:13px;color:var(--muted)}
</style>
</head>
<body>

<div class="container">

  <!-- header -->
  <div class="header">
    <div class="brand">
      <div class="logo">FT</div>
      <div>
        <div class="shopTitle">F T shop</div>
        <div class="smallNote">Ù…ØªØ¬Ø± Ø¨Ù†ÙØ³Ø¬ÙŠ Ø¹ØµØ±ÙŠ â€¢ ØªÙˆØµÙŠÙ„ Ù„ÙƒÙ„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª ÙˆÙ„Ù…ÙƒØ§ØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯</div>
      </div>
    </div>

    <div class="header-actions">
      <button class="btn btn-ghost" id="openUploadBtn">â• Ø£Ø¶Ù Ø³Ù„Ø¹ØªÙƒ</button>
      <button class="btn btn-ghost" id="openAdminBtn">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ</button>
      <button class="btn btn-primary" id="whatsappBtn">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</button>
    </div>
  </div>

  <!-- hero -->
  <div class="hero">
    <div class="left">
      <h1>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ F T shop</h1>
      <p>ØªØ³ÙˆÙ‘Ù‚ Ø¨Ø£Ù…Ø§Ù†ØŒ Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§ØªÙƒØŒ ÙˆØ§Ø·Ù„Ø¨ Ù…Ø¹ ØªÙˆØµÙŠÙ„ Ø«Ø§Ø¨Øª Ù„ÙƒÙ„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª â€” Ø³Ù‡Ù„ ÙˆØ§Ø­ØªØ±Ø§ÙÙŠ.</p>
      <div style="margin-top:12px">
        <button class="btn btn-primary" onclick="scrollToStore()">ğŸ›’ Ø§Ø°Ù‡Ø¨ Ù„Ù„Ù…ØªØ¬Ø±</button>
        <button class="btn btn-ghost" onclick="openUpload()">â• Ø£Ø¶Ù Ø³Ù„Ø¹ØªÙƒ</button>
      </div>
    </div>
    <div class="right" style="min-width:260px;">
      <div style="background:linear-gradient(135deg,#ffffff,rgba(255,255,255,0.9));padding:12px;border-radius:12px;color:#3b1050;box-shadow:var(--shadow)">
        <div style="font-weight:800;font-size:18px">Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…</div>
        <div style="margin-top:8px;color:#000">
          <div style="font-weight:700">iPhone 12 â€” Ø§Ø²Ø±Ù‚</div>
          <div class="smallNote">Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© 97% â€¢ Ø§Ù„Ø­Ø§Ù„Ø© 10/10 â€¢ Ù‚Ø·Ø¹ Ø£ØµÙ„ÙŠØ©</div>
          <div style="margin-top:10px;font-size:20px;color:var(--purple-2);font-weight:900">70,000 Ø¯Ø¬</div>
          <div style="margin-top:10px">
            <button class="btn btn-primary" onclick="addToCartDemo()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- main -->
  <div class="main">
    <!-- products -->
    <div class="storePanel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:800;font-size:18px">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
        <div class="smallNote">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ</div>
      </div>

      <div id="productsGrid" class="grid" style="margin-top:12px">
        <!-- Ù…Ù†ØªØ¬Ø§Øª ØªÙØ­Ù…Ù‘Ù„ Ù…Ù† JS -->
      </div>

      <div style="margin-top:12px;text-align:center">
        <button class="btn btn-ghost" onclick="openUpload()">â• Ø§Ù‚ØªØ±Ø­ Ø³Ù„Ø¹Ø© / Ø£Ø¶Ù Ø³Ù„Ø¹ØªÙƒ</button>
      </div>
    </div>

    <!-- sidebar -->
    <aside class="sidebar">
      <div class="card-side">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:800">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
          <div class="smallNote" id="cartCount">0</div>
        </div>

        <div class="cartList" id="cartList" style="margin-top:8px">
          <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø³Ù„Ø© -->
        </div>

        <div class="totals">
          <div class="totalRow"><div>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</div><div id="subTotalText">0 Ø¯Ø¬</div></div>
          <div class="totalRow"><div>Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø«Ø§Ø¨Øª)</div><div id="shippingText">400 Ø¯Ø¬</div></div>
          <div class="totalRow" style="font-size:18px"><div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</div><div id="grandTotalText">0 Ø¯Ø¬</div></div>

          <div style="margin-top:8px;display:flex;gap:8px">
            <button class="btn btn-primary" id="checkoutBtn" style="flex:1">ğŸ§¾ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
            <button class="btn btn-ghost" id="clearCartBtn">ğŸ—‘ï¸ ØªÙØ±ÙŠØº</button>
          </div>
        </div>
      </div>

      <div class="card-side">
        <div style="font-weight:800">Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</div>
        <div class="smallNote" style="margin-top:8px">Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ØªÙˆÙØ± Ù„ÙƒÙ„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ùˆ Ù…ÙƒØ§ØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯. Ø§Ù„Ø³Ø¹Ø± Ø«Ø§Ø¨Øª Ù„ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: <strong>400 Ø¯Ø¬</strong></div>
        <div style="margin-top:10px">
          <button class="btn btn-primary" id="contactSellerBtn">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¨Ø§Ø¦Ø¹</button>
        </div>
      </div>

      <div class="card-side">
        <div style="font-weight:800">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©</div>
        <div class="smallNote" style="margin-top:8px">ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ ØµÙˆØ± Ù…Ù†ØªØ¬Ø§ØªÙƒØŒ Ø£Ø±Ø³Ù„ Ø§Ù‚ØªØ±Ø§Ø­ ÙˆØ³ÙŠÙØ±Ø³Ù„ Ù„Ùƒ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆÙ†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.</div>
      </div>
    </aside>
  </div>

  <div class="footer">Â© <span id="year"></span> F T shop â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</div>
</div>

<!-- ===== MODALS ===== -->
<div class="modal-back" id="modalUpload">
  <div class="modal" role="dialog" aria-modal="true">
    <h2>Ø£Ø¶Ù / Ø§Ù‚ØªØ±Ø­ Ø³Ù„Ø¹ØªÙƒ</h2>
    <p class="smallNote">Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ù„Ø¹Ø© Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯ ØµØ§Ø­Ø¨ Ø§Ù„Ù…ØªØ¬Ø± Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.</p>

    <div style="margin-top:8px">
      <div class="form-row">
        <input class="input" id="p_title" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" />
        <input class="input" id="p_price" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø¬)" type="number" />
        <textarea id="p_desc" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ±"></textarea>
        <input type="file" id="p_image" accept="image/*" />
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button class="btn btn-ghost" onclick="closeModal('modalUpload')">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="btn btn-primary" onclick="submitProposal()">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø§Ù„Ùƒ</button>
      </div>
    </div>
  </div>
</div>

<div class="modal-back" id="modalAdmin">
  <div class="modal" role="dialog">
    <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ</h2>
    <p class="smallNote">ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§. Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙˆØ­Ø© ØªØ®Ø²Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…ØªØµÙØ­Ùƒ (localStorage).</p>

    <div style="margin-top:8px;display:flex;gap:8px;flex-direction:column">
      <div style="display:flex;gap:8px">
        <input class="input" id="admin_title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬" />
        <input class="input" id="admin_price" placeholder="Ø§Ù„Ø³Ø¹Ø±" type="number" />
      </div>
      <input class="input" id="admin_image" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (URL) Ø£Ùˆ Ø§ØªØ±Ùƒ ÙØ§Ø±Øº" />
      <textarea id="admin_desc" class="input" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬"></textarea>

      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="btn btn-ghost" onclick="closeModal('modalAdmin')">Ø¥ØºÙ„Ø§Ù‚</button>
        <button class="btn btn-primary" onclick="adminAddProduct()">Ø­ÙØ¸ Ù…Ù†ØªØ¬</button>
      </div>

      <div style="margin-top:12px">
        <div style="font-weight:800;margin-bottom:6px">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>
        <div id="adminProducts" style="display:flex;flex-direction:column;gap:8px;max-height:220px;overflow:auto"></div>
      </div>

    </div>
  </div>
</div>

<!-- ===== SCRIPTS ===== -->
<script>
/* ===== Config (Ø¹Ø¯Ù„ Ù‡Ù†Ø§ Ø¨Ø³Ù‡ÙˆÙ„Ø©) ===== */
const STORE_EMAIL = "YOUR_STORE_EMAIL@example.com"; // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ù‡Ù†Ø§
const WHATSAPP_NUMBER = ""; // Ø¶Ø¹ Ø±Ù‚Ù…Ùƒ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¨ØµÙŠØºØ© 213661234567 Ø£Ùˆ Ø§ØªØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹
const SHIPPING_COST = 400; // Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ø«Ø§Ø¨Øª (Ø¯Ø¬)
const SHOP_NAME = "F T shop";
/* ==================================== */

document.getElementById('year').textContent = new Date().getFullYear();

/* ---------- Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø¯Ø¦ÙŠØ© Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø±Ø¶ÙŠØ© ---------- */
/* ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ Ø£Ùˆ ØªØºÙŠÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
let defaultProducts = [
  {
    id: 'p_demo_iphone12',
    title: 'iPhone 12 â€” Ø£Ø²Ø±Ù‚',
    price: 70000,
    desc: 'Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©: 97% â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: 10/10 â€¢ Ù‚Ø·Ø¹ Ø£ØµÙ„ÙŠØ©',
    image: 'https://fdn2.gsmarena.com/vv/pics/apple/apple-iphone-12-2.jpg'
  },
  {
    id: 'p_demo_watch',
    title: 'Ø³Ø§Ø¹Ø© Ø°ÙƒÙŠØ© - Ù…ÙˆØ¯ÙŠÙ„ S',
    price: 12000,
    desc: 'Ù…Ù‚Ø§ÙˆÙ…Ø© Ù„Ù„Ù…Ø§Ø¡ØŒ Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ØŒ Ù…ÙˆØ§ØµÙØ§Øª ÙƒØ§Ù…Ù„Ø©',
    image: 'https://cdn.pixabay.com/photo/2017/08/07/10/21/smart-watch-2601139_1280.jpg'
  },
  {
    id: 'p_demo_headset',
    title: 'Ø³Ù…Ø§Ø¹Ø§Øª Ø¨Ù„ÙˆØªÙˆØ« Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©',
    price: 4500,
    desc: 'ØµÙˆØª Ù†Ù‚ÙŠØŒ Ø¹Ø²Ù„ Ù„Ù„Ø¶ÙˆØ¶Ø§Ø¡ØŒ Ø¨Ø·Ø§Ø±ÙŠØ© Ø·ÙˆÙŠÙ„Ø©',
    image: 'https://cdn.pixabay.com/photo/2016/11/29/03/53/headphones-1868910_1280.jpg'
  }
];

/* ---------- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ localStorage ---------- */
function loadProducts(){
  let stored = JSON.parse(localStorage.getItem('ft_products') || 'null');
  if(!stored){ localStorage.setItem('ft_products', JSON.stringify(defaultProducts)); stored = defaultProducts; }
  return stored;
}
function saveProducts(arr){ localStorage.setItem('ft_products', JSON.stringify(arr)); }

/* ---------- Ø±Ù†Ø¯Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---------- */
function renderProducts(){
  const grid = document.getElementById('productsGrid');
  grid.innerHTML = '';
  const products = loadProducts();
  products.forEach(p=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <div class="card-img"><img src="${p.image}" alt="${escapeHtml(p.title)}" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'"></div>
      <div class="card-body">
        <h3>${escapeHtml(p.title)}</h3>
        <div class="smallNote">${escapeHtml(p.desc)}</div>
        <div class="priceRow">
          <div class="price">${numberWithCommas(p.price)} Ø¯Ø¬</div>
          <div class="actions">
            <button class="btn btn-primary" onclick="addToCart('${p.id}')">ğŸ›’ Ø£Ø¶Ù</button>
            <button class="btn btn-ghost" onclick="quickBuy('${p.id}')">Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†</button>
          </div>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
}

/* ---------- Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ---------- */
let CART = JSON.parse(localStorage.getItem('ft_cart') || '[]');

function saveCart(){ localStorage.setItem('ft_cart', JSON.stringify(CART)); updateCartUI(); }

function addToCart(productId){
  const products = loadProducts();
  const p = products.find(x=>x.id===productId);
  if(!p) return alert('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
  const existing = CART.find(x=>x.id===productId);
  if(existing) existing.qty += 1;
  else CART.push({ id:p.id, title:p.title, price:p.price, image:p.image, qty:1 });
  saveCart();
  toast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©');
}

function addToCartDemo(){ addToCart('p_demo_iphone12'); }

/* Ø­Ø°Ù/ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ…ÙŠØ© */
function removeFromCart(productId){
  CART = CART.filter(x=>x.id!==productId);
  saveCart();
}
function changeQty(productId, delta){
  const item = CART.find(x=>x.id===productId);
  if(!item) return;
  item.qty += delta;
  if(item.qty < 1) item.qty = 1;
  saveCart();
}

/* update UI cart */
function updateCartUI(){
  const list = document.getElementById('cartList');
  list.innerHTML = '';
  if(!CART.length){
    list.innerHTML = '<div class="smallNote">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>';
    document.getElementById('cartCount').textContent = 0;
    document.getElementById('subTotalText').textContent = '0 Ø¯Ø¬';
    document.getElementById('grandTotalText').textContent = '0 Ø¯Ø¬';
    return;
  }
  let subtotal = 0;
  CART.forEach(item=>{
    subtotal += item.price * item.qty;
    const el = document.createElement('div'); el.className='cartItem';
    el.innerHTML = `<img src="${item.image}" onerror="this.src='https://via.placeholder.com/120x80?text=No+Image'"><div style="flex:1">
      <div style="font-weight:700">${escapeHtml(item.title)}</div>
      <div class="smallNote">${numberWithCommas(item.price)} Ø¯Ø¬ Ã— ${item.qty}</div>
      <div style="margin-top:6px;display:flex;gap:6px">
        <button class="btn btn-ghost" onclick="changeQty('${item.id}', -1)">âˆ’</button>
        <button class="btn btn-ghost" onclick="changeQty('${item.id}', 1)">+</button>
        <button class="btn btn-ghost" onclick="removeFromCart('${item.id}')">Ø­Ø°Ù</button>
      </div>
    </div>`;
    list.appendChild(el);
  });

  const shipping = SHIPPING_COST();
  const grand = subtotal + shipping;
  document.getElementById('cartCount').textContent = CART.reduce((s,i)=>s+i.qty,0);
  document.getElementById('subTotalText').textContent = numberWithCommas(subtotal) + ' Ø¯Ø¬';
  document.getElementById('shippingText').textContent = numberWithCommas(shipping) + ' Ø¯Ø¬';
  document.getElementById('grandTotalText').textContent = numberWithCommas(grand) + ' Ø¯Ø¬';
}

/* ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø© */
document.getElementById('clearCartBtn').addEventListener('click', ()=>{
  if(!CART.length) return;
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©ØŸ')) return;
  CART = []; saveCart(); toast('ØªÙ… ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©');
});

/* Checkout -> ÙŠÙØªØ­ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø¹ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ */
document.getElementById('checkoutBtn').addEventListener('click', ()=>{
  if(!CART.length) return alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©');
  const name = prompt('Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:');
  if(!name) return;
  const phone = prompt('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:');
  if(!phone) return;
  const address = prompt('Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø§Ù„ÙˆÙ„Ø§ÙŠØ©/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ø¹Ù†ÙˆØ§Ù†):');
  if(!address) return;

  const shipping = SHIPPING_COST();
  let subtotal = CART.reduce((s,i)=>s + i.price * i.qty, 0);
  const grand = subtotal + shipping;
  // compose body
  let body = `Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ù…Ù† ${SHOP_NAME}%0A%0AØ§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: ${name}%0AØ§Ù„Ù‡Ø§ØªÙ: ${phone}%0AØ§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}%0A%0AØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:%0A`;
  CART.forEach(i => {
    body += `- ${i.title} x${i.qty} = ${i.price * i.qty} Ø¯Ø¬%0A`;
  });
  body += `%0AØ§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${numberWithCommas(subtotal)} Ø¯Ø¬%0AØ³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„: ${numberWithCommas(shipping)} Ø¯Ø¬%0AØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${numberWithCommas(grand)} Ø¯Ø¬%0A`;
  body += `%0A(ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹)`;

  // mailto
  const mailto = `mailto:${encodeURIComponent(STORE_EMAIL)}?subject=${encodeURIComponent('Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹')}&body=${body}`;
  window.location.href = mailto;
  // optionally, clear cart after checkout:
  // CART = []; saveCart();
});

/* ---------- Upload proposals (client-side) ---------- */
function openUpload(){ document.getElementById('modalUpload').style.display='flex'; }
function openAdmin(){ document.getElementById('modalAdmin').style.display='flex'; }
function closeModal(id){ document.getElementById(id).style.display='none'; }

/* Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù‚ØªØ±Ø§Ø­ - Ù†Ù‚ÙˆÙ… Ø¨Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø© ÙƒÙ€ dataURL Ø«Ù… ØªØ®Ø²ÙŠÙ† Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ (mailto Ù…Ø¹ ØªÙØ§ØµÙŠÙ„) */
function submitProposal(){
  const title = document.getElementById('p_title').value.trim();
  const price = document.getElementById('p_price').value.trim();
  const desc = document.getElementById('p_desc').value.trim();
  const file = document.getElementById('p_image').files[0];
  if(!title || !price || !desc || !file) return alert('Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø®ØªØ± ØµÙˆØ±Ø©');
  if(!file.type.startsWith('image/')) return alert('Ø§Ø®ØªØ± Ù…Ù„Ù ØµÙˆØ±Ø©');

  const reader = new FileReader();
  reader.onload = function(e){
    const dataUrl = e.target.result;
    // save proposal to localStorage
    const proposals = JSON.parse(localStorage.getItem('ft_proposals') || '[]');
    const id = 'prop_' + Date.now();
    proposals.push({ id, title, price: Number(price), desc, image: dataUrl, date: new Date().toISOString() });
    localStorage.setItem('ft_proposals', JSON.stringify(proposals));
    closeModal('modalUpload');
    toast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ØŒ Ø³ÙŠØªØ·Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù„Ù†Ø´Ø±Ù‡');

    // send mailto notification (Ù…Ù„Ø­ÙˆØ¸Ø©: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±ÙØ§Ù‚ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ø¨Ø± mailtoØ› ÙÙ‚Ø· Ù†Ø®Ø¨Ø± Ø§Ù„Ù…Ø§Ù„Ùƒ Ø¨ÙˆØ¬ÙˆØ¯ Ø§Ù‚ØªØ±Ø§Ø­)
    const mailBody = encodeURIComponent(`ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:%0AØ¹Ù†ÙˆØ§Ù†: ${title}%0AØ§Ù„Ø³Ø¹Ø±: ${price} Ø¯Ø¬%0AÙˆØµÙ: ${desc}%0AÙ…Ø¹Ø§ÙŠÙ†Ø©: Ø§ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØµÙˆØ±Ø©.`);
    window.location.href = `mailto:${encodeURIComponent(STORE_EMAIL)}?subject=${encodeURIComponent('Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©')}&body=${mailBody}`;
  };
  reader.readAsDataURL(file);
}

/* ---------- Admin functions (local) ---------- */
document.getElementById('openAdminBtn').addEventListener('click', ()=>{
  const pass = prompt('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø§Ù„Ùƒ (Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: 1234):');
  if(pass !== '1234') return alert('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©'); // Ø­Ù…Ø§ÙŠØ© Ø¨Ø³ÙŠØ·Ø© (ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡Ø§)
  openAdmin();
  renderAdminProducts();
});

function adminAddProduct(){
  const title = document.getElementById('admin_title').value.trim();
  const price = Number(document.getElementById('admin_price').value || 0);
  const image = document.getElementById('admin_image').value.trim() || 'https://via.placeholder.com/400x300?text=No+Image';
  const desc = document.getElementById('admin_desc').value.trim();
  if(!title || !price) return alert('Ø§Ù„Ø³ÙƒÙˆØª: Ø§Ù…Ù„Ø£ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø³Ø¹Ø±');
  const products = loadProducts();
  products.push({ id: 'p_' + Date.now(), title, price, desc, image });
  saveProducts(products);
  renderProducts(); renderAdminProducts();
  toast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬');
  // clear fields
  document.getElementById('admin_title').value=''; document.getElementById('admin_price').value=''; document.getElementById('admin_image').value=''; document.getElementById('admin_desc').value='';
}

function renderAdminProducts(){
  const wrap = document.getElementById('adminProducts'); wrap.innerHTML = '';
  const products = loadProducts();
  products.slice().reverse().forEach(p=>{
    const el = document.createElement('div'); el.style.display='flex'; el.style.alignItems='center'; el.style.justifyContent='space-between';
    el.style.gap='8px'; el.style.padding='8px'; el.style.border='1px solid rgba(0,0,0,0.04)'; el.style.borderRadius='8px';
    el.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><img src="${p.image}" style="width:56px;height:40px;object-fit:cover;border-radius:6px" onerror="this.src='https://via.placeholder.com/120x80?text=No+Image'"><div><div style="font-weight:700">${escapeHtml(p.title)}</div><div class="smallNote">${numberWithCommas(p.price)} Ø¯Ø¬</div></div></div>
    <div style="display:flex;gap:6px">
      <button class="btn btn-ghost" onclick="editProduct('${p.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
      <button class="btn btn-ghost" onclick="deleteProduct('${p.id}')">Ø­Ø°Ù</button>
    </div>`;
    wrap.appendChild(el);
  });
}

function editProduct(id){
  const products = loadProducts();
  const p = products.find(x=>x.id===id);
  if(!p) return alert('Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
  const title = prompt('Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:', p.title); if(!title) return;
  const price = prompt('Ø§Ù„Ø³Ø¹Ø±:', p.price); if(!price) return;
  const desc = prompt('Ø§Ù„ÙˆØµÙ:', p.desc || '');
  const image = prompt('Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©:', p.image) || p.image;
  p.title = title; p.price = Number(price); p.desc = desc; p.image = image;
  saveProducts(products); renderProducts(); renderAdminProducts();
  toast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬');
}

function deleteProduct(id){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
  let products = loadProducts(); products = products.filter(x=>x.id!==id); saveProducts(products);
  renderProducts(); renderAdminProducts(); toast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬');
}

/* ---------- proposals management (admin can approve to publish) ---------- */
function getProposals(){ return JSON.parse(localStorage.getItem('ft_proposals') || '[]'); }
function renderProposalsAdmin(){
  const props = getProposals();
  if(!props.length) return;
  // simple rendering: alert listing and option to approve via adminProducts view
  let list = 'Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©:\\n';
  props.forEach((p,i)=> list += `${i+1}. ${p.title} â€” ${p.price} Ø¯Ø¬\\n`);
  alert(list + '\\nØ§ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹.');
}

/* approve proposal -> ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù…Ù†ØªØ¬ Ù…Ù†Ø´ÙˆØ± */
function approveProposal(id){
  const props = getProposals();
  const idx = props.findIndex(p=>p.id===id);
  if(idx === -1) return alert('ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
  const p = props.splice(idx,1)[0];
  localStorage.setItem('ft_proposals', JSON.stringify(props));
  const prods = loadProducts(); prods.push({ id:'p_' + Date.now(), title:p.title, price:p.price, desc:p.desc, image:p.image });
  saveProducts(prods);
  renderProducts(); renderAdminProducts();
  toast('ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬');
}

/* ---------- helper utilities ---------- */
function numberWithCommas(x){ return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* small toast */
function toast(msg){
  const el = document.createElement('div'); el.textContent = msg;
  el.style.position='fixed'; el.style.bottom='18px'; el.style.left='50%'; el.style.transform='translateX(-50%)';
  el.style.background='linear-gradient(90deg,var(--purple-1),var(--purple-2))'; el.style.color='white'; el.style.padding='10px 16px';
  el.style.borderRadius='999px'; el.style.boxShadow='0 6px 24px rgba(0,0,0,0.2)'; el.style.zIndex=9999;
  document.body.appendChild(el);
  setTimeout(()=> el.style.opacity='0.01',2200);
  setTimeout(()=> el.remove(),2500);
}

/* shipping cost getter (JS) */
function SHIPPING_COST(){ return Number(${SHIPPING_COST} || ${SHIPPING_COST}); } // replaced later programmatically

/* quick buy (ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¨Ø±ÙŠØ¯ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯) */
function quickBuy(productId){
  const products = loadProducts(); const p = products.find(x=>x.id===productId); if(!p) return;
  const name = prompt('Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:'); if(!name) return;
  const phone = prompt('Ù‡Ø§ØªÙ:'); if(!phone) return;
  const addr = prompt('Ø§Ù„Ø¹Ù†ÙˆØ§Ù†/Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:'); if(!addr) return;
  const shipping = SHIPPING_COST();
  const total = (p.price) + shipping;
  let body = `Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ù…Ù† ${SHOP_NAME}%0A%0AØ§Ø³Ù…: ${name}%0AØ§Ù„Ù‡Ø§ØªÙ: ${phone}%0AØ§Ù„Ø¹Ù†ÙˆØ§Ù†: ${addr}%0A%0AØ§Ù„Ù…Ù†ØªØ¬: ${p.title}%0AØ§Ù„Ø³Ø¹Ø±: ${p.price} Ø¯Ø¬%0AØ³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„: ${shipping} Ø¯Ø¬%0AØ§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total} Ø¯Ø¬`;
  window.location.href = `mailto:${encodeURIComponent(STORE_EMAIL)}?subject=${encodeURIComponent('Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ - ' + p.title)}&body=${encodeURIComponent(body)}`;
}

/* whatsapp/contact */
document.getElementById('whatsappBtn').addEventListener('click', ()=>{
  if(!WHATSAPP_NUMBER) return alert('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± Ù…Ø¶Ø§Ù Ø¨Ø¹Ø¯. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØªÙ‡ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒÙˆØ¯.');
  window.open('https://wa.me/' + WHATSAPP_NUMBER + '?text=' + encodeURIComponent('Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ù„Ø¯ÙŠ Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù…Ù†ØªØ¬Ø§ØªÙƒÙ…'));
});

document.getElementById('contactSellerBtn').addEventListener('click', ()=>{
  window.location.href = `mailto:${encodeURIComponent(STORE_EMAIL)}?subject=${encodeURIComponent('Ø§Ø³ØªÙØ³Ø§Ø± Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹')}`;
});

/* utils: init */
function init(){
  // replace placeholder SHIPPING_COST function with actual value injected

  // if user didn't replace email, warn once
  if(STORE_EMAIL === 'YOUR_STORE_EMAIL@example.com') console.warn('Please set STORE_EMAIL variable in the script to receive orders.');
  renderProducts(); updateCartUI();
}
init();

/* helper: open modals for upload/admin */
document.getElementById('openUploadBtn').addEventListener('click', openUpload);

function scrollToStore(){ window.scrollTo({ top: document.querySelector('.storePanel').offsetTop - 20, behavior:'smooth' }); }

/* ensure saveCart at start */
saveCart();

/* close modals on backdrop click */
document.querySelectorAll('.modal-back').forEach(b=>{
  b.addEventListener('click', (ev)=>{ if(ev.target === b) b.style.display='none'; });
});
</script>

</body>
</html>
